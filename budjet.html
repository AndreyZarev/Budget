<!DOCTYPE html>
<html lang="bg">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–ë—é–¥–∂–µ—Ç —Å –ì—Ä–∞—Ñ–∏–∫–∞ –∏ –ó–∞–ø–∞–∑–≤–∞–Ω–µ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f9f9f9;
            padding: 20px;
            text-align: center;
        }

        h1,
        h2 {
            color: #333;
        }

        table {
            margin: auto;
            width: 90%;
            border-collapse: collapse;
            background: #fff;
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        th,
        td {
            padding: 10px;
            border: 1px solid #ddd;
        }

        th {
            background: #4CAF50;
            color: white;
        }

        input[type="number"] {
            width: 100%;
            padding: 5px;
            text-align: right;
        }

        tfoot td {
            font-weight: bold;
            background: #f0f0f0;
        }

        .positive {
            color: green;
        }

        .negative {
            color: red;
        }

        #chart-container {
            width: 95%;
            margin: 20px auto;
        }

        button {
            padding: 10px 20px;
            margin: 10px;
            font-size: 1rem;
            cursor: pointer;
        }
    </style>
</head>

<body>

    <h1>–ì–æ–¥–∏—à–µ–Ω –ë—é–¥–∂–µ—Ç –∏ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞</h1>

    <table>
        <thead>
            <tr>
                <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                <th>–°—É–º–∞ (–ª–≤)</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>–î–æ—Ö–æ–¥</td>
                <td>–ó–∞–ø–ª–∞—Ç–∞</td>
                <td><input type="number" class="income" value="0"></td>
            </tr>
            <tr>
                <td>–î–æ—Ö–æ–¥</td>
                <td>–î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–µ–Ω –¥–æ—Ö–æ–¥</td>
                <td><input type="number" class="income" value="0"></td>
            </tr>
            <tr>
                <td>–î–æ—Ö–æ–¥</td>
                <td>–ü–æ–º–æ—â–∏</td>
                <td><input type="number" class="income" value="0"></td>
            </tr>

            <tr>
                <td>–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</td>
                <td>–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—É—Ç–∞</td>
                <td><input type="number" class="investment" value="0"></td>
            </tr>
            <tr>
                <td>–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</td>
                <td>–ë–ª–∞–≥–æ—Ä–æ–¥–Ω–∏ –º–µ—Ç–∞–ª–∏</td>
                <td><input type="number" class="investment" value="0"></td>
            </tr>

            <tr>
                <td>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞</td>
                <td>–•—Ä–∞–Ω–∞ –∑–∞ —Å—ä—Ö—Ä–∞–Ω–µ–Ω–∏–µ</td>
                <td><input type="number" class="prep" value="0"></td>
            </tr>
            <tr>
                <td>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞</td>
                <td>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ –∏ –æ–±–æ—Ä—É–¥–≤–∞–Ω–µ</td>
                <td><input type="number" class="prep" value="0"></td>
            </tr>
            <tr>
                <td>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞</td>
                <td>–ï–Ω–µ—Ä–≥–∏—è (—Å–æ–ª–∞—Ä, –±–∞—Ç–µ—Ä–∏–∏)</td>
                <td><input type="number" class="prep" value="0"></td>
            </tr>

            <tr>
                <td>–†–∞–∑—Ö–æ–¥</td>
                <td>–ù–∞–µ–º/–ö—Ä–µ–¥–∏—Ç</td>
                <td><input type="number" class="expense" value="0"></td>
            </tr>
            <tr>
                <td>–†–∞–∑—Ö–æ–¥</td>
                <td>–°–º–µ—Ç–∫–∏ –∏ —É—Å–ª—É–≥–∏</td>
                <td><input type="number" class="expense" value="0"></td>
            </tr>
            <tr>
                <td>–†–∞–∑—Ö–æ–¥</td>
                <td>–ì–æ—Ä–∏–≤–æ</td>
                <td><input type="number" class="expense" value="0"></td>
            </tr>
            <tr>
                <td>–†–∞–∑—Ö–æ–¥</td>
                <td>–•—Ä–∞–Ω–∞ –∏ –±–∏—Ç–æ–≤–∏</td>
                <td><input type="number" class="expense" value="0"></td>
            </tr>
            <tr>
                <td>–†–∞–∑—Ö–æ–¥</td>
                <td>–ì–∞–ª–µ–Ω–∞ ‚ù§Ô∏è</td>
                <td><input type="number" class="expense" value="0"></td>
            </tr>
        </tbody>
        <tfoot>
            <tr>
                <td colspan="2">–û–±—â–æ –¥–æ—Ö–æ–¥</td>
                <td id="total-income">0 –ª–≤</td>
            </tr>
            <tr>
                <td colspan="2">–û–±—â–æ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</td>
                <td id="total-investment">0 –ª–≤</td>
            </tr>
            <tr>
                <td colspan="2">–û–±—â–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞</td>
                <td id="total-prep">0 –ª–≤</td>
            </tr>
            <tr>
                <td colspan="2">–û–±—â–æ —Ä–∞–∑—Ö–æ–¥–∏</td>
                <td id="total-expense">0 –ª–≤</td>
            </tr>
            <tr>
                <td colspan="2">–û—Å—Ç–∞—Ç—ä–∫</td>
                <td id="balance">0 –ª–≤</td>
            </tr>
        </tfoot>
    </table>

    <button onclick="saveMonth()">üì¶ –ó–∞–ø–∞–∑–∏ –º–µ—Å–µ—Ü</button>
    <button onclick="removeLastMonth()">üóëÔ∏è –ò–∑—Ç—Ä–∏–π –ø–æ—Å–ª–µ–¥–Ω–∏—è –º–µ—Å–µ—Ü</button>
    <button onclick="clearData()">üóëÔ∏è –ò–∑—Ç—Ä–∏–π –≤—Å–∏—á–∫–æ</button>

    <h2>üìä –ì–æ–¥–∏—à–Ω–∞ –ì—Ä–∞—Ñ–∏–∫–∞</h2>
    <div id="chart-container">
        <canvas id="yearChart"></canvas>
    </div>

    <script>
        const selectors = {
            income: ".income",
            investment: ".investment",
            prep: ".prep",
            expense: ".expense"
        };

        function sum(selector) {
            return Array.from(document.querySelectorAll(selector)).reduce((a, el) => a + parseFloat(el.value || 0), 0);
        }

        function updateTotals() {
            const income = sum(selectors.income);
            const investment = sum(selectors.investment);
            const prep = sum(selectors.prep);
            const expense = sum(selectors.expense);
            const balance = income - (investment + prep + expense);

            document.getElementById("total-income").textContent = `${income.toFixed(2)} –ª–≤`;
            document.getElementById("total-investment").textContent = `${investment.toFixed(2)} –ª–≤`;
            document.getElementById("total-prep").textContent = `${prep.toFixed(2)} –ª–≤`;
            document.getElementById("total-expense").textContent = `${expense.toFixed(2)} –ª–≤`;

            const bal = document.getElementById("balance");
            bal.textContent = `${balance.toFixed(2)} –ª–≤`;
            bal.className = balance >= 0 ? "positive" : "negative";

            return { income, investment, prep, expense, balance };
        }

        document.querySelectorAll("input").forEach(el => el.addEventListener("input", updateTotals));
        updateTotals();

        function saveMonth() {
            const data = JSON.parse(localStorage.getItem("yearlyData") || "[]");
            const now = new Date();
            const monthLabel = now.toLocaleString('bg-BG', { month: 'long', year: 'numeric' });

            const totals = updateTotals();
            data.push({ month: monthLabel, ...totals });

            localStorage.setItem("yearlyData", JSON.stringify(data));
            renderChart();
        }

        function clearData() {
            if (confirm("–ù–∞–∏—Å—Ç–∏–Ω–∞ –ª–∏ –∏—Å–∫–∞—Ç–µ –¥–∞ –∏–∑—Ç—Ä–∏–µ—Ç–µ –≤—Å–∏—á–∫–∏ –∑–∞–ø–∏—Å–∞–Ω–∏ –¥–∞–Ω–Ω–∏?")) {
                localStorage.removeItem("yearlyData");
                renderChart();
            }
        }
        function removeLastMonth() {
            let data = JSON.parse(localStorage.getItem("yearlyData") || "[]");
            if (data.length === 0) {
                alert("–ù—è–º–∞ –∑–∞–ø–∏—Å–∞–Ω–∏ –º–µ—Å–µ—Ü–∏ –∑–∞ –∏–∑—Ç—Ä–∏–≤–∞–Ω–µ.");
                return;
            }

            if (confirm(`–î–∞ –∏–∑—Ç—Ä–∏–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏—è –º–µ—Å–µ—Ü: "${data[data.length - 1].month}"?`)) {
                data.pop();
                localStorage.setItem("yearlyData", JSON.stringify(data));
                renderChart();
            }
        }
        function renderChart() {
            const raw = JSON.parse(localStorage.getItem("yearlyData") || "[]");
            const labels = raw.map(d => d.month);
            const datasets = [
                { label: "–î–æ—Ö–æ–¥", data: raw.map(d => d.income), backgroundColor: "#4CAF50" },
                { label: "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏", data: raw.map(d => d.investment), backgroundColor: "#2196F3" },
                { label: "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞", data: raw.map(d => d.prep), backgroundColor: "#FF9800" },
                { label: "–†–∞–∑—Ö–æ–¥–∏", data: raw.map(d => d.expense), backgroundColor: "#f44336" },
                { label: "–û—Å—Ç–∞—Ç—ä–∫", data: raw.map(d => d.balance), backgroundColor: "#9C27B0" }
            ];

            if (window.yearChart instanceof Chart) {
                window.yearChart.destroy();
            }

            const ctx = document.getElementById("yearChart").getContext("2d");
            window.yearChart = new Chart(ctx, {
                type: "bar",
                data: { labels, datasets },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }

        renderChart();
    </script>

</body>

</html>